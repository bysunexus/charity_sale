<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:p="http://www.springframework.org/schema/p"
       xmlns:cache="http://www.springframework.org/schema/cache"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.1.xsd
		http://www.springframework.org/schema/cache http://www.springframework.org/schema/cache/spring-cache-4.1.xsd">
  <cache:annotation-driven cache-manager="cacheManager"/>
  <!-- spring自己的换管理器，这里定义了两个缓存位置名称 ，既注解中的value -->
  <beans profile="dev">
    <bean id="cacheManager" class="org.springframework.cache.support.SimpleCacheManager">
      <property name="caches">
        <set>
          <bean class="org.springframework.cache.concurrent.ConcurrentMapCacheFactoryBean" p:name="code"/>
          <bean class="org.springframework.cache.concurrent.ConcurrentMapCacheFactoryBean" p:name="codes"/>
        </set>
      </property>
    </bean>
  </beans>
  <beans profile="prd">
    <bean id="memcachedClient" class="net.spy.memcached.spring.MemcachedClientFactoryBean">
      <property name="servers" value="${memcached.servers}" />
      <property name="protocol" value="BINARY" />
      <property name="transcoder">
        <bean class="net.spy.memcached.transcoders.SerializingTranscoder">
          <property name="compressionThreshold" value="${memcached.transcoder.compressionThreshold}" />
        </bean>
      </property>
      <property name="opTimeout" value="${memcached.opTimeout}" />
      <property name="timeoutExceptionThreshold" value="${memcached.timeoutExceptionThreshold}" />
      <property name="hashAlg">
        <value type="net.spy.memcached.DefaultHashAlgorithm">${memcached.hashAlg}</value>
      </property>
      <property name="locatorType" value="${memcached.locatorType}" />
      <property name="failureMode" value="${memcached.failureMode}" />
      <property name="useNagleAlgorithm" value="${memcached.useNagleAlgorithm}" />
    </bean>

    <bean id="cacheManager" class="com.charity.core.cache.MemcachedCacheManager">
      <property name="client" ref="memcachedClient"/>
      <property name="caches">
        <set>
          <bean class="com.charity.core.cache.MemcachedCache">
            <property name="name" value="code"/>
            <property name="client" ref="memcachedClient"/>
          </bean>
          <bean class="com.charity.core.cache.MemcachedCache">
            <property name="name" value="codes"/>
            <property name="client" ref="memcachedClient"/>
          </bean>
        </set>
      </property>
    </bean>
  </beans>

</beans>
